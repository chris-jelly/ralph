{
  "branchName": "ralph/global-install",
  "userStories": [
    {
      "id": "US-001",
      "title": "Define path constants for new .ralph/ structure",
      "description": "Define new constant variables for repo-local paths to support the new .ralph/ directory structure. Update ralph.sh and related scripts to use these configurable path constants.",
      "acceptanceCriteria": [
        "RALPH_REPO_DIR constant defined (default: .ralph)",
        "RALPH_PLANS_DIR constant defined (default: .ralph/plans)",
        "RALPH_CONFIG constant defined (default: .ralph/config)",
        "Constants are used consistently across ralph.sh, doctor.sh, and install.sh",
        "Scripts remain functional with default values"
      ],
      "priority": "high",
      "passes": true,
      "notes": "Foundation for all other stories. Change path references from hardcoded strings to constants."
    },
    {
      "id": "US-002",
      "title": "Create global CLI wrapper entry point (bin/ralph)",
      "description": "Create a new top-level executable script at bin/ralph that serves as the global install entry point. This script should resolve the repo root by walking up the directory tree until .git/ is found.",
      "acceptanceCriteria": [
        "bin/ralph script exists and is executable",
        "Resolves repo root correctly from any subdirectory",
        "Handles case when not in a git repository (graceful error)",
        "Can be symlinked to ~/.local/bin/ralph",
        "Delegates to existing ralph.sh engine functionality"
      ],
      "priority": "high",
      "passes": true,
      "notes": "This becomes the single global entry point installed to PATH"
    },
    {
      "id": "US-003",
      "title": "Add mode dispatching to bin/ralph wrapper",
      "description": "Implement subcommand dispatching in bin/ralph to support init, plan, build, summary, doctor, and migrate modes. Load .ralph/config if present to get tool and other settings.",
      "acceptanceCriteria": [
        "bin/ralph init command works",
        "bin/ralph plan command works",
        "bin/ralph build command works (default)",
        "bin/ralph summary command works",
        "bin/ralph doctor command works",
        "bin/ralph migrate command works",
        "Loads .ralph/config for tool configuration"
      ],
      "priority": "high",
      "passes": true,
      "notes": "Keeps existing ralph.sh as the engine that the wrapper dispatches to"
    },
    {
      "id": "US-004",
      "title": "Implement ralph init command",
      "description": "Implement the init subcommand that sets up a repo with .ralph/ structure. Create specs/ and specs/README.md if missing, create .ralph/config, .ralph/.gitignore with nested ignore pattern, and .ralph/plans/ structure.",
      "acceptanceCriteria": [
        "ralph init creates .ralph/config file with defaults",
        "ralph init creates .ralph/.gitignore with nested ignore (*, !config, !.gitignore)",
        "ralph init creates .ralph/plans/ directory structure",
        "ralph init does NOT modify repo root .gitignore",
        "ralph init creates specs/README.md template if missing",
        "ralph init is idempotent (safe to run multiple times)"
      ],
      "priority": "high",
      "passes": true,
      "notes": "The zero-friction setup command for new repos"
    },
    {
      "id": "US-005",
      "title": "Update ralph.sh to use .ralph/plans/ paths",
      "description": "Update ralph.sh to reference .ralph/plans/ instead of plans/ for prd.json, progress.txt, implementation_plan.md, archive/, and .last-branch. Update all hardcoded path references.",
      "acceptanceCriteria": [
        "PLANS_DIR uses RALPH_PLANS_DIR constant",
        "PRD_FILE references .ralph/plans/prd.json",
        "PROGRESS_FILE references .ralph/plans/progress.txt",
        "ARCHIVE_DIR references .ralph/plans/archive/",
        "LAST_BRANCH_FILE references .ralph/plans/.last-branch",
        "Plan mode archives to .ralph/plans/archive/",
        "All file operations work correctly"
      ],
      "priority": "high",
      "passes": true,
      "notes": "Core path migration for the engine"
    },
    {
      "id": "US-006",
      "title": "Update AGENTS prompts to reference .ralph/plans/",
      "description": "Update AGENTS.md, AGENTS_plan.md, AGENTS_summary.md to reference .ralph/plans/ instead of plans/ in all instructions to agents.",
      "acceptanceCriteria": [
        "AGENTS.md references .ralph/plans/prd.json",
        "AGENTS.md references .ralph/plans/progress.txt",
        "AGENTS_plan.md references .ralph/plans/ for plan mode",
        "AGENTS_summary.md references .ralph/plans/ for summary mode",
        "All path references updated consistently"
      ],
      "priority": "high",
      "passes": true,
      "notes": "Agents need updated instructions for new paths"
    },
    {
      "id": "US-007",
      "title": "Update doctor.sh for .ralph/ structure",
      "description": "Update doctor.sh validation checks to verify .ralph/config exists, .ralph/plans/ is writable, tool is on PATH, and specs/README.md exists. Update Git ignore checks for the new pattern.",
      "acceptanceCriteria": [
        "doctor.sh checks .ralph/config exists (not plans/)",
        "doctor.sh checks .ralph/plans/ is writable",
        "doctor.sh checks .ralph/.gitignore exists with correct pattern",
        "doctor.sh checks tool is on PATH",
        "doctor.sh checks specs/README.md exists",
        " doctor.sh provides helpful hints for any failures"
      ],
      "priority": "medium",
      "passes": true,
      "notes": "Health checks for new structure"
    },
    {
      "id": "US-008",
      "title": "Add backward compatible path fallback to ralph.sh",
      "description": "Add fallback logic in ralph.sh to read from old paths if new .ralph/ paths don't exist. Fall back to scripts/ralph/ralph.conf if .ralph/config missing, and plans/prd.json if .ralph/plans/prd.json missing.",
      "acceptanceCriteria": [
        "ralph.sh checks .ralph/config first, falls back to scripts/ralph/ralph.conf",
        "ralph.sh checks .ralph/plans/prd.json first, falls back to plans/prd.json",
        "ralph.sh checks .ralph/plans/progress.txt first, falls back to plans/progress.txt",
        "Fallback logic works for all file operations",
        "Backward compatibility maintained"
      ],
      "priority": "medium",
      "passes": true,
      "notes": "Allows existing repos to continue working"
    },
    {
      "id": "US-009",
      "title": "Create migrate.sh script for old installations",
      "description": "Create ralph/migrate.sh distribution script that safely migrates old installations to new .ralph/ structure. Must support --dry-run (default), --apply, --backup-dir, --fix-gitignore, and --remove-old flags.",
      "acceptanceCriteria": [
        "migrate.sh with --dry-run shows what would change",
        "migrate.sh with --apply performs migration safely",
        "migrate.sh --apply creates .ralph/ structure",
        "migrate.sh --apply creates .ralph/.gitignore with nested ignore",
        "migrate.sh --apply copies files from plans/ to .ralph/plans/",
        "migrate.sh --apply creates .ralph/config from old ralph.conf",
        "migrate.sh --fix-gitignore cleans up old entries",
        "migrate.sh --remove-old moves old directories to backup",
        "migrate.sh refuses to run outside git repo",
        "migrate.sh shows post-run summary"
      ],
      "priority": "high",
      "passes": true,
      "notes": "Migration script is critical for existing users"
    },
    {
      "id": "US-010",
      "title": "Implement ralph migrate subcommand",
      "description": "Implement the migrate subcommand in bin/ralph wrapper that detects old layout and offers to run migrate.sh. Should also detect if migration is needed and prompt user.",
      "acceptanceCriteria": [
        "ralph migrate detects scripts/ralph/ and .ralph/ existence",
        "ralph migrate prompts user before running",
        "ralph migrate can invoke migrate.sh with flags",
        "ralph migrate provides clear guidance",
        "Migration detection works correctly"
      ],
      "priority": "medium",
      "passes": true,
      "notes": "User-friendly migration entry point"
    },
    {
      "id": "US-011",
      "title": "Update install.sh for new .ralph/ structure",
      "description": "Update install.sh to install to .ralph/ directory structure instead of scripts/ralph/. Create .ralph/.gitignore with nested ignore pattern to avoid modifying repo .gitignore.",
      "acceptanceCriteria": [
        "install.sh installs to .ralph/ directory",
        "install.sh creates .ralph/.gitignore with nested ignore pattern",
        "install.sh does not modify repo root .gitignore",
        "install.sh creates .ralph/config file",
        "install.sh maintains backward compatibility option",
        "install.sh tests work correctly"
      ],
      "priority": "medium",
      "passes": true,
      "notes": "Installation needs to create new structure"
    },
    {
      "id": "US-012",
      "title": "Create curl bootstrap script for easy installation",
      "description": "Create a small curl bootstrap script that users can run to install Ralph globally. The script should perform git clone of Ralph repo to ~/.local/share/ralph and create symlink to ~/.local/bin/ralph.",
      "acceptanceCriteria": [
        "bootstrap.sh downloads and runs cleanly",
        "bootstrap.sh clones repo to ~/.local/share/ralph",
        "bootstrap.sh creates symlink ~/.local/bin/ralph",
        "bootstrap.sh checks if already installed",
        "bootstrap.sh verifies ~/.local/bin is on PATH",
        "bootstrap.sh provides clear instructions"
      ],
      "priority": "low",
      "notes": "Optional convenience feature"
    },
    {
      "id": "US-013",
      "title": "Add ralph self-update command",
      "description": "Add self-update subcommand to bin/ralph that runs git pull in the installation directory when Ralph was installed from git clone. Provide clear feedback to user.",
      "acceptanceCriteria": [
        "ralph self-update runs git -C ~/.local/share/ralph pull",
        "ralph self-update provides clear success message",
        "ralph self-update handles non-git installations gracefully",
        "ralph self-update handles network errors gracefully"
      ],
      "priority": "low",
      "notes": "Convenience command for updating"
    },
    {
      "id": "US-014",
      "title": "Create bash tests for ralph init",
      "description": "Create test file tests/test_ralph_init.sh that tests ralph init idempotency, .ralph/.gitignore behavior (only config tracked), and creation of required structure.",
      "acceptanceCriteria": [
        "test_ralph_init.sh creates temp test repo",
        "test_ralph_init.sh runs ralph init",
        "test_ralph_init.sh verifies .ralph/config created",
        "test_ralph_init.sh verifies .ralph/.gitignore created with correct pattern",
        "test_ralph_init.sh verifies specs/README.md created",
        "test_ralph_init.sh verifies running ralph init again is safe",
        "test_ralph_init.sh verifies repo .gitignore not modified",
        "Test passes"
      ],
      "priority": "medium",
      "passes": true,
      "notes": "Critical for confidence in init command"
    },
    {
      "id": "US-015",
      "title": "Create bash tests for path resolution",
      "description": "Create test file tests/test_path_resolution.sh that tests repo root resolution from subdirectories and bin/ralph wrapper path resolution.",
      "acceptanceCriteria": [
        "test_path_resolution.sh creates temp repo structure",
        "Test resolves repo root correctly from nested subdirectory",
        "Test handles not-in-git case gracefully",
        "Test validates ralph.sh finds files correctly",
        "Test passes"
      ],
      "priority": "medium",
      "passes": false,
      "notes": "Critical for CLI wrapper reliability"
    },
    {
      "id": "US-016",
      "title": "Create bash tests for backward compatibility",
      "description": "Create test file tests/test_backward_compat.sh that tests fallback path logic for old paths when new .ralph/ paths don't exist.",
      "acceptanceCriteria": [
        "test_backward_compat.sh creates repo with old structure",
        "Test verifies ralph.sh falls back to scripts/ralph/ralph.conf",
        "Test verifies ralph.sh falls back to plans/prd.json",
        "Test verifies fallback works correctly",
        "Test verifies new paths take priority",
        "Test passes"
      ],
      "priority": "medium",
      "passes": false,
      "notes": "Critical for existing repos"
    },
    {
      "id": "US-017",
      "title": "Create bash tests for migrate.sh",
      "description": "Create test file tests/test_migrate.sh that tests migrate.sh behavior with various flags (--dry-run, --apply, --fix-gitignore, --remove-old).",
      "acceptanceCriteria": [
        "test_migrate.sh creates repo with old structure",
        "Test --dry-run safely shows changes without applying",
        "Test --apply creates .ralph/ structure",
        "Test --apply copies files correctly",
        "Test --fix-gitignore cleans entries",
        "Test --remove-old moves directories to backup",
        "Test refuses to run outside git repo",
        "Test passes"
      ],
      "priority": "medium",
      "passes": false,
      "notes": "Critical for migration reliability"
    },
    {
      "id": "US-018",
      "title": "Update README.md with global install instructions",
      "description": "Update ralph/README.md with new installation instructions showing both git clone + symlink method and optional curl bootstrap, plus WSL considerations and ralph init usage.",
      "acceptanceCriteria": [
        "README.md documents git clone + symlink to ~/.local/share/ralph",
        "README.md documents optional curl bootstrap script",
        "README.md documents ralph init command",
        "README.md documents ralph migrate command",
        "README.md includes WSL setup notes",
        "README.md mentions ~/.local/bin on PATH requirement",
        "README.md is clear and accurate"
      ],
      "priority": "low",
      "notes": "Documentation for users"
    }
  ],
  "metadata": {
    "version": "1.0",
    "generatedDate": "2026-02-02"
  }
}

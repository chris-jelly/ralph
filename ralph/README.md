# Ralph - Autonomous AI Agent Loop

Ralph is an autonomous coding agent that implements PRD user stories iteratively using AI coding tools.

## Installation

### One-liner (recommended)

```bash
curl -fsSL https://raw.githubusercontent.com/chris-jelly/ralph/main/ralph/bootstrap.sh | bash
```

This clones Ralph to `~/.local/share/ralph/` and symlinks the `ralph` command to `~/.local/bin/ralph`.

### Manual install

```bash
git clone https://github.com/chris-jelly/ralph.git ~/.local/share/ralph
mkdir -p ~/.local/bin
ln -s ~/.local/share/ralph/bin/ralph ~/.local/bin/ralph
```

Ensure `~/.local/bin` is on your `PATH`.

### Update

```bash
ralph self-update
```

## Quick Start

```bash
# Initialize Ralph in your project
cd my-project
ralph init

# Write specs (optional but recommended)
# Edit specs/README.md and add spec files to specs/

# Create implementation plan
# Edit .ralph/plans/implementation_plan.md

# Generate PRD from plan + specs
ralph plan

# Review and adjust .ralph/plans/prd.json

# Build the stories
ralph build

# Optionally suggest spec improvements
ralph summary
```

## How It Works

Ralph supports three modes for different phases of development:

### Three-Layer Model

1. **Specs (`specs/`)** - Human-curated documentation for project context
2. **Implementation Plan (`.ralph/plans/implementation_plan.md`)** - Your interactive goal document
3. **PRD (`.ralph/plans/prd.json`)** - AI-generated breakdown into actionable user stories

### Plan Mode

Reads your implementation plan and specs, searches the codebase to determine what exists vs. what's missing, then generates `.ralph/plans/prd.json` with prioritized user stories. Also updates `implementation_plan.md` with findings.

**Does NOT:**
- Modify source code files
- Modify anything in `specs/`

### Build Mode

Implements the PRD iteratively. Each iteration:
1. Reads `.ralph/plans/prd.json` for user stories
2. Implements the highest priority incomplete story
3. Runs quality checks (typecheck, lint, test)
4. Commits changes with format: `feat: [Story ID] - [Story Title]`
5. Updates the PRD to mark story as complete
6. Logs progress to `.ralph/plans/progress.txt`

When all stories have `passes: true`, Ralph outputs `<promise>COMPLETE</promise>` and exits.

### Summary Mode

Analyzes a completed run and suggests improvements to your specs. Reads `.ralph/plans/progress.txt`, `.ralph/plans/prd.json`, and relevant `specs/*.md` files, then generates `.ralph/plans/suggested_spec_changes.md` with recommendations.

**Does NOT:**
- Modify source code files
- Modify anything in `specs/`

## Specifications

The `specs/` directory contains human-curated project documentation that AI agents read selectively. This provides project-specific context without loading unnecessary files.

**How it works:**
- `specs/README.md` acts as an index that lists all specs organized by section with markdown tables
- Ralph reads specifications **selectively** based on the current story context (not all files at once)
- Ralph **never edits** specification files - they are human-maintained only

**Example structure:**
```
specs/
├── README.md                   # Index file - sections with tables listing specs and their purpose
├── api-patterns.md             # Read when working on API endpoints
├── ui-components.md            # Read when modifying UI code
└── database-schema.md          # Read when working on data models
```

## Usage

```bash
# Initialize Ralph in a repo
ralph init

# Build mode (default) - implements PRD stories
ralph build                # Max 10 iterations (default)
ralph build 20             # Max 20 iterations

# Plan mode - reads implementation plan, generates PRD
ralph plan                 # Max 10 iterations
ralph plan 5               # Max 5 iterations

# Summary mode - suggests spec improvements from completed run
ralph summary              # Single iteration

# Health check
ralph doctor

# Update Ralph
ralph self-update

# Help
ralph --help
```

## Files

After running `ralph init`, your repo will have:

- `.ralph/config` - Tool and iteration settings (tracked in git)
- `.ralph/.gitignore` - Nested ignore so only config is tracked
- `.ralph/plans/implementation_plan.md` - Template for your goals (edit before running `ralph plan`)
- `.ralph/plans/prd.json` - Your project's PRD (generated by plan mode)
- `.ralph/plans/progress.txt` - Auto-generated progress log
- `.ralph/plans/archive/` - Archived PRDs from previous runs
- `specs/README.md` - Index of project specifications

## PRD Format

See `prd.json.example` for the complete format. Key fields:

```json
{
  "project": "Project Name",
  "branchName": "feature/branch-name",
  "description": "What this PRD accomplishes",
  "userStories": [
    {
      "id": "US-001",
      "title": "Story title",
      "description": "As a user, I want...",
      "acceptanceCriteria": ["Criterion 1", "Criterion 2"],
      "priority": 1,
      "passes": false,
      "notes": ""
    }
  ]
}
```

## Tips

- **Keep stories small** - Each story should complete in one context window
- **Use acceptance criteria** - Clear, testable criteria help the AI know when it's done
- **Monitor progress.txt** - Check the "Learnings" sections for patterns discovered
- **Set realistic iterations** - Complex PRDs may need 15-20+ iterations

## Memory & Context

Ralph maintains memory across iterations through:

1. **Git history** - Each story is a separate commit
2. **`.ralph/plans/progress.txt`** - Running log of what was done and learned
3. **`.ralph/plans/prd.json`** - Updated `passes` status for each story
4. **Codebase Patterns suggestions** - Optional blocks embedded in progress entries

Each AI instance starts fresh with clean context, but these files provide continuity.

## Model Configuration

Ralph supports configuring different AI models for each mode. This allows you to use smarter (more expensive) models for planning and review, while using cheaper models for the build phase.

### Environment Variables

Configure models using environment variables in your `.ralph/config`:

- `RALPH_PLAN_MODEL` - Model to use for plan mode
- `RALPH_BUILD_MODEL` - Model to use for build mode
- `RALPH_REVIEW_MODEL` - Model to use for summary mode
- `RALPH_MODEL` - Global fallback for all modes

### Fallback Chain

Models are resolved in this order:

```
RALPH_<MODE>_MODEL → RALPH_MODEL → tool default
```

For example, when running `ralph build`:
1. Check `RALPH_BUILD_MODEL`
2. If not set, check `RALPH_MODEL`
3. If still not set, let the tool use its default model

### Example Configuration

```bash
# .ralph/config

# Use powerful model for planning (complex reasoning)
RALPH_PLAN_MODEL=claude-sonnet-4-20250514

# Use cheap model for building (many iterations)
RALPH_BUILD_MODEL=codex-mini

# Use powerful model for review (thorough analysis)
RALPH_REVIEW_MODEL=claude-sonnet-4-20250514

# Global fallback (if no mode-specific model set)
# RALPH_MODEL=claude-3-5-sonnet

TOOL=claude
```

### Supported Tools and Models

| Tool | Model Flag | Example Models |
|------|-----------|----------------|
| `claude` | `--model` | claude-opus-4, claude-sonnet-4, claude-3-5-sonnet |
| `opencode` | `--model` | claude-sonnet-4-20250514, codex-mini |
| `codex` | `--model` | codex-mini, codex-cursor |

Run `ralph doctor` to see your currently configured models.

## Advanced

### Archiving

**Plan mode**: Always archives existing `.ralph/plans/prd.json` and `.ralph/plans/progress.txt` to `.ralph/plans/archive/` before starting, creating a fresh planning cycle.

**Build mode**: When you start a new PRD (different `branchName`), Ralph automatically archives the previous run to `.ralph/plans/archive/YYYY-MM-DD-branch-name/`.

### Quality Checks

Ralph expects your project to have quality checks. The AI will run whatever checks make sense for your project (e.g., `npm run typecheck`, `pytest`, `cargo test`).

## Legacy Installation

The old `install.sh` script is deprecated. If you previously installed Ralph per-repo with `install.sh`, you can migrate to the global install:

1. Install Ralph globally (see Installation above)
2. Run `ralph init` in your repo
3. The old `scripts/ralph/` directory can be removed
